buildscript {
    repositories {
        mavenCentral()
        jcenter()
        maven { url 'https://www.jetbrains.com/intellij-repository/releases' }
    }
}

plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.8.20'
    id 'org.jetbrains.intellij' version '1.13.3'
}

group 'com.nilsenlabs.flavormatrix'
version '1.2.0'

Properties properties = new Properties()
properties.load(project.rootProject.file("local.properties").newDataInputStream())


// Any developer must change this to his/her installation folder
// of Android Studio of the targetIdeVersion for which to build for
// When updating, update 4 source JAR dependencies manually to get
// the dev environment class resolution correctly:
// Project Settings > Modules
//  plugins\properties\lib\platform-images.jar
//  plugin\sproperties\lib\properties.jar
//  plugins\smali\lib\smali.jar
def defaultLocalStudioPath = 'C:/coding/android-studio-2022.1.1.19'
//def defaultLocalStudioPath = 'C:/Programfiler/android/Android Studio'

// Specify the path in your local.properties file as
// localStudioPath=your/path/to/androidstudio
// Also see https://plugins.jetbrains.com/docs/intellij/tools-gradle-intellij-plugin.html#intellij-extension-localpath
def localStudioPath = properties.get("localStudioPath") ?: defaultLocalStudioPath

// Below: Android Studio Giraffe | 2022.3.1 Beta 1 . ALWAYS UPDATE PLUGIN.XML AS WELL
def targetIdeVersion = "223.8617.56"

// Build #IC-213.6777.52, built on January 28, 2022

// The other machine: 'c:/Program Files/Android/Android Studio 4.1 RC3'

intellij {
    // Uncomment the two lines below and remove "localPath" if you want to build for a different version than the one locally installed
    // version = targetIdeVersion
    // type = 'IC'                // Community edition

    plugins = ['android']
    localPath = localStudioPath

    // since-build and until-build is configured in plugin.xml.
    // Update whenever rebuilt for later IDEA version.
    updateSinceUntilBuild = false
}

patchPluginXml {
    changeNotes = """
    <ul>
      <li>1.2.0 Support for Android Studio Giraffe</li>
      <li>1.1.0 Support for Android Studio Electric Eel</li>
      <li>1.0.0 Support for Android Studio Chipmunk (RC2+)</li>
      <li>0.7.0 Support for Android studio Arctic Fox 2020.3.1</li>
      <li>0.6.0 Support for Android 4.2</li>
    </ul>
    """
}

runIde {
    ideDir.set(file(localStudioPath))

}

instrumentCode {
    compilerVersion = targetIdeVersion
}

repositories {
    mavenLocal()
    mavenCentral()
    jcenter()
    maven { url 'https://www.jetbrains.com/intellij-repository/releases' }
}

dependencies {
    testImplementation group: 'junit', name: 'junit', version: '4.12'
    testImplementation "org.mockito:mockito-core:2.+"
}

//publishPlugin {
//   token project.properties['jetbrains.publish.token']
//}
